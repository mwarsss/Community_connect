<!DOCTYPE html>
<html>
  <head>
    <title>Opportunities</title>
  </head>
  <body>
    <h1>Community Connect</h1>
    <form method="GET" action="/">
      <input
        type="text"
        name="q"
        placeholder="Search by title/category"
        value="{{ request.args.get('q', '') }}"
      />
      <select name="category">
        <option value="">All Categories</option>
        {% for cat in categories %}
          <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
      </select>
      <button type="submit">Search</button>
    </form>

    <a href="/new">+ Post New Opportunity</a>

    <ul>
      {% for opp in opportunities %}
      <li>
        <strong>{{ opp.title }}</strong> ({{ opp.category }})<br />
        {{ opp.description }}<br />
        üìç {{ opp.location }}
      </li>
      {% else %}
      <li>No opportunities found.</li>
      {% endfor %}
    </ul>

    {% with messages = get_flashed_messages(with_categories=True) %}
      {% if messages %}
        <ul>
        {% for category, msg in messages %}
          <li style="color: {% if category == 'error' %}red{% else %}green{% endif %};">{{ msg }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
  </body>
</html>
